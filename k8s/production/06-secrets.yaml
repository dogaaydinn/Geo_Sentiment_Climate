# Secrets Management for Geo Climate Platform
#
# IMPORTANT SECURITY NOTES:
# ========================
# 1. NEVER commit actual secrets to Git
# 2. This file contains TEMPLATES with base64-encoded PLACEHOLDERS
# 3. For production, use one of these approaches:
#    - External Secrets Operator (recommended)
#    - HashiCorp Vault
#    - AWS Secrets Manager / Azure Key Vault / GCP Secret Manager
#    - Sealed Secrets (bitnami-labs/sealed-secrets)
#    - SOPS (Mozilla's encrypted secrets)
#
# 4. To generate actual secrets:
#    echo -n "your-secret-value" | base64
#
# 5. Apply secrets BEFORE other resources:
#    kubectl create secret generic geo-climate-secrets --from-env-file=.env.production
#
# Usage:
#   # Create from file (recommended)
#   kubectl create secret generic geo-climate-secrets \
#     --from-literal=database-url="postgresql://..." \
#     --from-literal=jwt-secret="..." \
#     --namespace=geo-climate
#
#   # Or apply this template (after replacing values)
#   kubectl apply -f k8s/production/06-secrets.yaml

---
# Database Secrets
apiVersion: v1
kind: Secret
metadata:
  name: postgres-secrets
  namespace: geo-climate
  labels:
    app: geo-climate
    component: database
type: Opaque
data:
  # PostgreSQL credentials
  # REPLACE WITH: echo -n "actual-password" | base64
  POSTGRES_USER: Z2VvX2NsaW1hdGU=  # geo_climate
  POSTGRES_PASSWORD: Q0hBTkdFX01FX1BMRUFTRSEhIQ==  # CHANGE_ME_PLEASE!!!
  POSTGRES_DB: Z2VvX2NsaW1hdGVfcHJvZA==  # geo_climate_prod

  # Connection strings
  # Format: postgresql://user:password@host:port/database
  DATABASE_URL: cG9zdGdyZXNxbDovL2dlb19jbGltYXRlOkNIQU5HRV9NRV9QTEVBU0UhISFAcG9zdGdyZXM6NTQzMi9nZW9fY2xpbWF0ZV9wcm9k

  # Replication user (for PostgreSQL HA)
  POSTGRES_REPLICATION_USER: cmVwbGljYXRvcg==  # replicator
  POSTGRES_REPLICATION_PASSWORD: Q0hBTkdFX01FX1JFUExJQ0FUSU9OISE=  # CHANGE_ME_REPLICATION!

---
# Redis Secrets
apiVersion: v1
kind: Secret
metadata:
  name: redis-secrets
  namespace: geo-climate
  labels:
    app: geo-climate
    component: cache
type: Opaque
data:
  # Redis password
  REDIS_PASSWORD: Q0hBTkdFX01FX1JFRElTISEh  # CHANGE_ME_REDIS!!!

  # Redis connection URL
  # Format: redis://:password@host:port/db
  REDIS_URL: cmVkaXM6Ly86Q0hBTkdFX01FX1JFRElTISEhQHJlZGlzOjYzNzkvMA==

---
# Application Secrets
apiVersion: v1
kind: Secret
metadata:
  name: geo-climate-secrets
  namespace: geo-climate
  labels:
    app: geo-climate
    component: api
type: Opaque
data:
  # JWT Configuration
  # Generate with: openssl rand -hex 32 | base64
  JWT_SECRET_KEY: Q0hBTkdFX01FX0pXVF9TRUNSRVRfS0VZXzMyX0NIQVJTX01JTklNVU0hISE=  # CHANGE_ME_JWT_SECRET_KEY_32_CHARS_MINIMUM!!!
  JWT_REFRESH_SECRET_KEY: Q0hBTkdFX01FX1JFRlJFU0hfS0VZXzMyX0NIQVJTX01JTklNVU0hISE=  # CHANGE_ME_REFRESH_KEY_32_CHARS_MINIMUM!!!

  # API Keys for external services
  OPENWEATHER_API_KEY: Q0hBTkdFX01FX09QRU5XRUFUSEVSISEh  # CHANGE_ME_OPENWEATHER!!!
  GOOGLE_MAPS_API_KEY: Q0hBTkdFX01FX0dPT0dMRV9NQVBTISE=  # CHANGE_ME_GOOGLE_MAPS!!

  # Encryption keys (for data at rest)
  # Generate with: openssl rand -base64 32
  ENCRYPTION_KEY: Q0hBTkdFX01FX0VOQ1JZUFRJT05fS0VZXzQ0X0NIQVJTX0JBU0U2NCEhIQ==  # CHANGE_ME_ENCRYPTION_KEY_44_CHARS_BASE64!!!

  # OAuth/Social Login (if applicable)
  GOOGLE_CLIENT_ID: Q0hBTkdFX01FX0dPT0dMRV9DTElFTlRfSUQhISE=  # CHANGE_ME_GOOGLE_CLIENT_ID!!!
  GOOGLE_CLIENT_SECRET: Q0hBTkdFX01FX0dPT0dMRV9DTElFTlRfU0VDUkVUISEh  # CHANGE_ME_GOOGLE_CLIENT_SECRET!!!

  # Monitoring & Alerting
  SENTRY_DSN: Q0hBTkdFX01FX1NFTlRSWV9EU04hISE=  # CHANGE_ME_SENTRY_DSN!!!
  SLACK_WEBHOOK_URL: Q0hBTkdFX01FX1NMQUNLX1dFQkhPT0shISE=  # CHANGE_ME_SLACK_WEBHOOK!!!

---
# TLS Certificates (managed by cert-manager)
# These are auto-generated by cert-manager, but can be manually created
apiVersion: v1
kind: Secret
metadata:
  name: geo-climate-tls-secret
  namespace: geo-climate
  labels:
    app: geo-climate
type: kubernetes.io/tls
data:
  # Auto-populated by cert-manager
  # If manually creating:
  # tls.crt: <base64-encoded-certificate>
  # tls.key: <base64-encoded-private-key>

---
# Docker Registry Credentials (for private images)
apiVersion: v1
kind: Secret
metadata:
  name: docker-registry-secret
  namespace: geo-climate
  labels:
    app: geo-climate
type: kubernetes.io/dockerconfigjson
data:
  # Create with:
  # kubectl create secret docker-registry docker-registry-secret \
  #   --docker-server=https://index.docker.io/v1/ \
  #   --docker-username=<username> \
  #   --docker-password=<password> \
  #   --docker-email=<email> \
  #   --namespace=geo-climate
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJDSEFOR0VfTUUiLCJwYXNzd29yZCI6IkNIQU5HRV9NRSIsImVtYWlsIjoiQ0hBTkdFX01FIn19fQ==

---
# Basic Auth for Metrics Endpoint
# Generate with: htpasswd -nb admin password | base64
apiVersion: v1
kind: Secret
metadata:
  name: basic-auth
  namespace: geo-climate
  labels:
    app: geo-climate
    component: monitoring
type: Opaque
data:
  # Format: username:hashed-password
  # Generate with: htpasswd -nb admin your-password | base64
  auth: YWRtaW46JGFwcjEkSDY1dnNYdnUkdEh3M3FOQ0lPRkkyTVc4UUdNZ0dGLgo=  # admin:CHANGE_ME

---
# ============================================================================
# PRODUCTION SECRET MANAGEMENT RECOMMENDATIONS
# ============================================================================
#
# Option 1: External Secrets Operator (Recommended)
# --------------------------------------------------
# Install: https://external-secrets.io/
#
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: vault-backend
#   namespace: geo-climate
# spec:
#   provider:
#     vault:
#       server: "https://vault.example.com"
#       path: "secret"
#       version: "v2"
#       auth:
#         kubernetes:
#           mountPath: "kubernetes"
#           role: "geo-climate"
#
# ---
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: geo-climate-secrets
#   namespace: geo-climate
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: vault-backend
#     kind: SecretStore
#   target:
#     name: geo-climate-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: JWT_SECRET_KEY
#       remoteRef:
#         key: geo-climate/jwt
#         property: secret_key
#
# Option 2: Sealed Secrets
# -------------------------
# Install: https://github.com/bitnami-labs/sealed-secrets
#
# # Encrypt secrets
# kubeseal --format=yaml < secrets.yaml > sealed-secrets.yaml
# # Apply encrypted secrets (safe to commit)
# kubectl apply -f sealed-secrets.yaml
#
# Option 3: SOPS (Secrets OPerationS)
# ------------------------------------
# Install: https://github.com/mozilla/sops
#
# # Encrypt file
# sops --encrypt --gcp-kms projects/PROJECT/locations/global/keyRings/KEYRING/cryptoKeys/KEY secrets.yaml > secrets.enc.yaml
# # Decrypt and apply
# sops --decrypt secrets.enc.yaml | kubectl apply -f -
#
# Option 4: Cloud Provider Secret Managers
# -----------------------------------------
# AWS: Use AWS Secrets Manager + CSI Driver
# Azure: Use Azure Key Vault + CSI Driver
# GCP: Use Google Secret Manager + CSI Driver
#
# Example with AWS Secrets Manager CSI Driver:
# apiVersion: secrets-store.csi.x-k8s.io/v1
# kind: SecretProviderClass
# metadata:
#   name: geo-climate-aws-secrets
#   namespace: geo-climate
# spec:
#   provider: aws
#   parameters:
#     objects: |
#       - objectName: "geo-climate/database-url"
#         objectType: "secretsmanager"
#       - objectName: "geo-climate/jwt-secret"
#         objectType: "secretsmanager"
#
# ============================================================================
# SECRET ROTATION STRATEGY
# ============================================================================
#
# 1. Database passwords: Rotate every 90 days
# 2. JWT secrets: Rotate every 180 days with overlap period
# 3. API keys: Rotate on compromise or annually
# 4. TLS certificates: Auto-renew via cert-manager (90 days)
# 5. Encryption keys: Version-based rotation with backward compatibility
#
# Automated rotation with External Secrets Operator:
# - Set refreshInterval: 24h
# - Store secrets in Vault with rotation policies
# - Monitor secret age with Prometheus alerts
#
# ============================================================================
# RBAC FOR SECRETS
# ============================================================================
#
# Limit who can read secrets:
# apiVersion: rbac.authorization.k8s.io/v1
# kind: Role
# metadata:
#   name: secret-reader
#   namespace: geo-climate
# rules:
#   - apiGroups: [""]
#     resources: ["secrets"]
#     resourceNames: ["geo-climate-secrets"]
#     verbs: ["get", "list"]
#
# ---
# apiVersion: rbac.authorization.k8s.io/v1
# kind: RoleBinding
# metadata:
#   name: secret-reader-binding
#   namespace: geo-climate
# subjects:
#   - kind: ServiceAccount
#     name: geo-climate-api
#     namespace: geo-climate
# roleRef:
#   kind: Role
#   name: secret-reader
#   apiGroup: rbac.authorization.k8s.io
#
# ============================================================================
# AUDIT & COMPLIANCE
# ============================================================================
#
# 1. Enable Kubernetes audit logging for secret access
# 2. Monitor secret reads with Falco or similar tools
# 3. Implement secret scanning in CI/CD (git-secrets, trufflehog)
# 4. Regular secret rotation audits
# 5. Compliance checks (SOC2, HIPAA, PCI-DSS if applicable)
#
# ============================================================================
